<!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>
<title>Chapter3_TheGraphicsProcessingUnit_KOR</title><style type='text/css'>html {overflow-x: initial !important;}:root { --bg-color:#ffffff; --text-color:#333333; --select-text-bg-color:#B5D6FC; --select-text-font-color:auto; --monospace:"Lucida Console",Consolas,"Courier",monospace; }
html { font-size: 14px; background-color: var(--bg-color); color: var(--text-color); font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; -webkit-font-smoothing: antialiased; }
body { margin: 0px; padding: 0px; height: auto; bottom: 0px; top: 0px; left: 0px; right: 0px; font-size: 1rem; line-height: 1.42857; overflow-x: hidden; background: inherit; tab-size: 4; }
iframe { margin: auto; }
a.url { word-break: break-all; }
a:active, a:hover { outline: 0px; }
.in-text-selection, ::selection { text-shadow: none; background: var(--select-text-bg-color); color: var(--select-text-font-color); }
#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; word-wrap: break-word; position: relative; white-space: normal; overflow-x: visible; padding-top: 40px; }
#write.first-line-indent p { text-indent: 2em; }
#write.first-line-indent li p, #write.first-line-indent p * { text-indent: 0px; }
#write.first-line-indent li { margin-left: 2em; }
.for-image #write { padding-left: 8px; padding-right: 8px; }
body.typora-export { padding-left: 30px; padding-right: 30px; }
.typora-export .footnote-line, .typora-export li, .typora-export p { white-space: pre-wrap; }
@media screen and (max-width: 500px) {
  body.typora-export { padding-left: 0px; padding-right: 0px; }
  #write { padding-left: 20px; padding-right: 20px; }
  .CodeMirror-sizer { margin-left: 0px !important; }
  .CodeMirror-gutters { display: none !important; }
}
#write li > figure:first-child { margin-top: -20px; }
#write ol, #write ul { position: relative; }
img { max-width: 100%; vertical-align: middle; }
button, input, select, textarea { color: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; }
input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
*, ::after, ::before { box-sizing: border-box; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p, #write pre { width: inherit; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p { position: relative; }
h1, h2, h3, h4, h5, h6 { break-after: avoid-page; break-inside: avoid; orphans: 2; }
p { orphans: 4; }
h1 { font-size: 2rem; }
h2 { font-size: 1.8rem; }
h3 { font-size: 1.6rem; }
h4 { font-size: 1.4rem; }
h5 { font-size: 1.2rem; }
h6 { font-size: 1rem; }
.md-math-block, .md-rawblock, h1, h2, h3, h4, h5, h6, p { margin-top: 1rem; margin-bottom: 1rem; }
.hidden { display: none; }
.md-blockmeta { color: rgb(204, 204, 204); font-weight: 700; font-style: italic; }
a { cursor: pointer; }
sup.md-footnote { padding: 2px 4px; background-color: rgba(238, 238, 238, 0.7); color: rgb(85, 85, 85); border-radius: 4px; cursor: pointer; }
sup.md-footnote a, sup.md-footnote a:hover { color: inherit; text-transform: inherit; text-decoration: inherit; }
#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; }
figure { overflow-x: auto; margin: 1.2em 0px; max-width: calc(100% + 16px); padding: 0px; }
figure > table { margin: 0px !important; }
tr { break-inside: avoid; break-after: auto; }
thead { display: table-header-group; }
table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; break-inside: auto; text-align: left; }
table.md-table td { min-width: 32px; }
.CodeMirror-gutters { border-right: 0px; background-color: inherit; }
.CodeMirror-linenumber { user-select: none; }
.CodeMirror { text-align: left; }
.CodeMirror-placeholder { opacity: 0.3; }
.CodeMirror pre { padding: 0px 4px; }
.CodeMirror-lines { padding: 0px; }
div.hr:focus { cursor: none; }
#write pre { white-space: pre-wrap; }
#write.fences-no-line-wrapping pre { white-space: pre; }
#write pre.ty-contain-cm { white-space: normal; }
.CodeMirror-gutters { margin-right: 4px; }
.md-fences { font-size: 0.9rem; display: block; break-inside: avoid; text-align: left; overflow: visible; white-space: pre; background: inherit; position: relative !important; }
.md-diagram-panel { width: 100%; margin-top: 10px; text-align: center; padding-top: 0px; padding-bottom: 8px; overflow-x: auto; }
#write .md-fences.mock-cm { white-space: pre-wrap; }
.md-fences.md-fences-with-lineno { padding-left: 0px; }
#write.fences-no-line-wrapping .md-fences.mock-cm { white-space: pre; overflow-x: auto; }
.md-fences.mock-cm.md-fences-with-lineno { padding-left: 8px; }
.CodeMirror-line, twitterwidget { break-inside: avoid; }
.footnotes { opacity: 0.8; font-size: 0.9rem; margin-top: 1em; margin-bottom: 1em; }
.footnotes + .footnotes { margin-top: 0px; }
.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; background: 0px 0px; text-decoration: none; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; -webkit-tap-highlight-color: transparent; line-height: normal; font-weight: 400; text-align: left; box-sizing: content-box; direction: ltr; }
li div { padding-top: 0px; }
blockquote { margin: 1rem 0px; }
li .mathjax-block, li p { margin: 0.5rem 0px; }
li { margin: 0px; position: relative; }
blockquote > :last-child { margin-bottom: 0px; }
blockquote > :first-child, li > :first-child { margin-top: 0px; }
.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; white-space: normal; }
#write .footnote-line { white-space: pre-wrap; }
@media print {
  body, html { border: 1px solid transparent; height: 99%; break-after: avoid; break-before: avoid; }
  #write { margin-top: 0px; padding-top: 0px; border-color: transparent !important; }
  .typora-export * { -webkit-print-color-adjust: exact; }
  html.blink-to-pdf { font-size: 13px; }
  .typora-export #write { padding-left: 32px; padding-right: 32px; padding-bottom: 0px; break-after: avoid; }
  .typora-export #write::after { height: 0px; }
  @page { margin: 20mm 0px; }
}
.footnote-line { margin-top: 0.714em; font-size: 0.7em; }
a img, img a { cursor: pointer; }
pre.md-meta-block { font-size: 0.8rem; min-height: 0.8rem; white-space: pre-wrap; background: rgb(204, 204, 204); display: block; overflow-x: hidden; }
p > .md-image:only-child:not(.md-img-error) img, p > img:only-child { display: block; margin: auto; }
p > .md-image:only-child { display: inline-block; width: 100%; }
#write .MathJax_Display { margin: 0.8em 0px 0px; }
.md-math-block { width: 100%; }
.md-math-block:not(:empty)::after { display: none; }
[contenteditable="true"]:active, [contenteditable="true"]:focus { outline: 0px; box-shadow: none; }
.md-task-list-item { position: relative; list-style-type: none; }
.task-list-item.md-task-list-item { padding-left: 0px; }
.md-task-list-item > input { position: absolute; top: 0px; left: 0px; margin-left: -1.2em; margin-top: calc(1em - 10px); border: none; }
.math { font-size: 1rem; }
.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-radius: 10px; }
.md-toc-content { position: relative; margin-left: 0px; }
.md-toc-content::after, .md-toc::after { display: none; }
.md-toc-item { display: block; color: rgb(65, 131, 196); }
.md-toc-item a { text-decoration: none; }
.md-toc-inner:hover { text-decoration: underline; }
.md-toc-inner { display: inline-block; cursor: pointer; }
.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: 700; }
.md-toc-h2 .md-toc-inner { margin-left: 2em; }
.md-toc-h3 .md-toc-inner { margin-left: 4em; }
.md-toc-h4 .md-toc-inner { margin-left: 6em; }
.md-toc-h5 .md-toc-inner { margin-left: 8em; }
.md-toc-h6 .md-toc-inner { margin-left: 10em; }
@media screen and (max-width: 48em) {
  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
  .md-toc-h4 .md-toc-inner { margin-left: 5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
  .md-toc-h6 .md-toc-inner { margin-left: 8em; }
}
a.md-toc-inner { font-size: inherit; font-style: inherit; font-weight: inherit; line-height: inherit; }
.footnote-line a:not(.reversefootnote) { color: inherit; }
.md-attr { display: none; }
.md-fn-count::after { content: "."; }
code, pre, samp, tt { font-family: var(--monospace); }
kbd { margin: 0px 0.1em; padding: 0.1em 0.6em; font-size: 0.8em; color: rgb(36, 39, 41); background: rgb(255, 255, 255); border: 1px solid rgb(173, 179, 185); border-radius: 3px; box-shadow: rgba(12, 13, 14, 0.2) 0px 1px 0px, rgb(255, 255, 255) 0px 0px 0px 2px inset; white-space: nowrap; vertical-align: middle; }
.md-comment { color: rgb(162, 127, 3); opacity: 0.8; font-family: var(--monospace); }
code { text-align: left; vertical-align: initial; }
a.md-print-anchor { white-space: pre !important; border-width: initial !important; border-style: none !important; border-color: initial !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: 0px !important; background: 0px 0px !important; text-decoration: initial !important; text-shadow: initial !important; }
.md-inline-math .MathJax_SVG .noError { display: none !important; }
.html-for-mac .inline-math-svg .MathJax_SVG { vertical-align: 0.2px; }
.md-math-block .MathJax_SVG_Display { text-align: center; margin: 0px; position: relative; text-indent: 0px; max-width: none; max-height: none; min-height: 0px; min-width: 100%; width: auto; overflow-y: hidden; display: block !important; }
.MathJax_SVG_Display, .md-inline-math .MathJax_SVG_Display { width: auto; margin: inherit; display: inline-block !important; }
.MathJax_SVG .MJX-monospace { font-family: var(--monospace); }
.MathJax_SVG .MJX-sans-serif { font-family: sans-serif; }
.MathJax_SVG { display: inline; font-style: normal; font-weight: 400; line-height: normal; zoom: 90%; text-indent: 0px; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0px; min-height: 0px; border: 0px; padding: 0px; margin: 0px; }
.MathJax_SVG * { transition: none; }
.MathJax_SVG_Display svg { vertical-align: middle !important; margin-bottom: 0px !important; }
.os-windows.monocolor-emoji .md-emoji { font-family: "Segoe UI Symbol", sans-serif; }
.md-diagram-panel > svg { max-width: 100%; }
[lang="mermaid"] svg, [lang="flow"] svg { max-width: 100%; }
[lang="mermaid"] .node text { font-size: 1rem; }
table tr th { border-bottom: 0px; }
video { max-width: 100%; display: block; margin: 0px auto; }
iframe { max-width: 100%; width: 100%; border: none; }
.highlight td, .highlight tr { border: 0px; }


:root { --side-bar-bg-color: #fafafa; --control-text-color: #777; }
html { font-size: 16px; }
body { font-family: "Noto Sans CJK JP", sans-serif; color: rgb(51, 51, 51); line-height: 1.6; }
#write { max-width: 860px; margin: 0px auto; padding: 20px 30px 100px; }
#write > ul:first-child, #write > ol:first-child { margin-top: 30px; }
body > :first-child { margin-top: 0px !important; }
body > :last-child { margin-bottom: 0px !important; }
a { color: rgb(65, 131, 196); }
h1, h2, h3, h4, h5, h6 { position: relative; margin-top: 1rem; margin-bottom: 1rem; font-weight: bold; line-height: 1.4; cursor: text; }
h1:hover a.anchor, h2:hover a.anchor, h3:hover a.anchor, h4:hover a.anchor, h5:hover a.anchor, h6:hover a.anchor { text-decoration: none; }
h1 tt, h1 code { font-size: inherit; }
h2 tt, h2 code { font-size: inherit; }
h3 tt, h3 code { font-size: inherit; }
h4 tt, h4 code { font-size: inherit; }
h5 tt, h5 code { font-size: inherit; }
h6 tt, h6 code { font-size: inherit; }
h1 { padding-bottom: 0.3em; font-size: 2.25em; line-height: 1.2; border-bottom: 1px solid rgb(238, 238, 238); }
h2 { padding-bottom: 0.3em; font-size: 1.75em; line-height: 1.225; border-bottom: 1px solid rgb(238, 238, 238); }
h3 { font-size: 1.5em; line-height: 1.43; }
h4 { font-size: 1.25em; }
h5 { font-size: 1em; }
h6 { font-size: 1em; color: rgb(119, 119, 119); }
p, blockquote, ul, ol, dl, table { margin: 0.8em 0px; }
li > ol, li > ul { margin: 0px; }
hr { height: 4px; padding: 0px; margin: 16px 0px; background-color: rgb(231, 231, 231); border-width: 0px 0px 1px; border-style: none none solid; border-top-color: initial; border-right-color: initial; border-left-color: initial; border-image: initial; overflow: hidden; box-sizing: content-box; border-bottom-color: rgb(221, 221, 221); }
body > h2:first-child { margin-top: 0px; padding-top: 0px; }
body > h1:first-child { margin-top: 0px; padding-top: 0px; }
body > h1:first-child + h2 { margin-top: 0px; padding-top: 0px; }
body > h3:first-child, body > h4:first-child, body > h5:first-child, body > h6:first-child { margin-top: 0px; padding-top: 0px; }
a:first-child h1, a:first-child h2, a:first-child h3, a:first-child h4, a:first-child h5, a:first-child h6 { margin-top: 0px; padding-top: 0px; }
h1 p, h2 p, h3 p, h4 p, h5 p, h6 p { margin-top: 0px; }
li p.first { display: inline-block; }
ul, ol { padding-left: 30px; }
ul:first-child, ol:first-child { margin-top: 0px; }
ul:last-child, ol:last-child { margin-bottom: 0px; }
blockquote { border-left: 4px solid rgb(221, 221, 221); padding: 0px 15px; color: rgb(119, 119, 119); }
blockquote blockquote { padding-right: 0px; }
table { padding: 0px; word-break: initial; }
table tr { border-top: 1px solid rgb(204, 204, 204); margin: 0px; padding: 0px; }
table tr:nth-child(2n) { background-color: rgb(248, 248, 248); }
table tr th { font-weight: bold; border: 1px solid rgb(204, 204, 204); text-align: left; margin: 0px; padding: 6px 13px; }
table tr td { border: 1px solid rgb(204, 204, 204); text-align: left; margin: 0px; padding: 6px 13px; }
table tr th:first-child, table tr td:first-child { margin-top: 0px; }
table tr th:last-child, table tr td:last-child { margin-bottom: 0px; }
.CodeMirror-gutters { border-right: 1px solid rgb(221, 221, 221); }
.md-fences, code, tt { border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: "Source Han Code JP", Menlo, Consolas, monospace; padding: 2px 4px 0px; font-size: 0.9em; }
.md-fences { margin-bottom: 15px; margin-top: 15px; padding: 8px 1em 6px; }
.task-list { padding-left: 0px; }
.task-list-item { padding-left: 32px; }
.task-list-item input { top: 3px; left: 8px; }
@media print {
  html { font-size: 13px; }
  table, pre { break-inside: avoid; }
  pre { word-wrap: break-word; }
}
.md-fences { background-color: rgb(248, 248, 248); }
#write pre.md-meta-block { padding: 1rem; font-size: 85%; line-height: 1.45; background-color: rgb(247, 247, 247); border: 0px; border-radius: 3px; color: rgb(119, 119, 119); margin-top: 0px !important; }
.mathjax-block > .code-tooltip { bottom: 0.375rem; }
#write > h3.md-focus::before { left: -1.5625rem; top: 0.375rem; }
#write > h4.md-focus::before { left: -1.5625rem; top: 0.285714rem; }
#write > h5.md-focus::before { left: -1.5625rem; top: 0.285714rem; }
#write > h6.md-focus::before { left: -1.5625rem; top: 0.285714rem; }
.md-image > .md-meta { border: 1px solid rgb(221, 221, 221); border-radius: 3px; font-family: "Source Han Code JP", Menlo, Consolas, monospace; padding: 2px 4px 0px; font-size: 0.9em; color: inherit; }
.md-tag { color: inherit; }
.md-toc { margin-top: 20px; padding-bottom: 20px; }
.sidebar-tabs { border-bottom: none; }
#typora-quick-open { border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); }
#typora-quick-open-item { background-color: rgb(250, 250, 250); border-color: rgb(254, 254, 254) rgb(229, 229, 229) rgb(229, 229, 229) rgb(238, 238, 238); border-style: solid; border-width: 1px; }
#md-notification::before { top: 10px; }
.on-focus-mode blockquote { border-left-color: rgba(85, 85, 85, 0.12); }
header, .context-menu, .megamenu-content, footer { font-family: "Noto Sans CJK JP", sans-serif; }
.file-node-content:hover .file-node-icon, .file-node-content:hover .file-node-open-state { visibility: visible; }
.mac-seamless-mode #typora-sidebar { background-color: var(--side-bar-bg-color); }
.md-lang { color: rgb(180, 101, 77); }





 .typora-export li, .typora-export p, .typora-export,  .footnote-line {white-space: normal;} 
</style>
</head>
<body class='typora-export os-windows' >
<div  id='write'  class = 'is-node'><h1><a name='header-n0' class='md-header-anchor '></a>Chapter 3 : The Graphics Processing Unit</h1><h2><a name='header-n2' class='md-header-anchor '></a>0. Intro</h2><ul><li><p>20년도 더 전에, NVIDIA 의 GeForce 256 이라는 그래픽 카드가 나오면서 GPU 시장은 격변기를 겪게 됨. 왜냐하면 GeForce 256 은 기존의 <em>하드웨어 래스터라이제이션</em> 만 가능했던 칩들과는 다르게 <strong>정점 처리</strong>를 하드웨어에서 지원해주는 기능이 있었기 때문.</p><ul><li>NVIDIA 는 이 카드를 기점으로 <strong>GPU (Graphics Processing Unit)</strong> 이라는 용어를 사용하게 함.</li></ul></li><li><p>이 이후로 복잡한 고정된 파이프라인 설계 지향의 GPU (Fixed Pipeline) 이 나오게 되고, 그리고 Shader 의 추가로 <strong>프로그래밍 가능하고, 유연한</strong> 파이프라인의 설계 지향의 GPU 들이 나오게 됨.</p></li><li><p>GPU 는 <strong>병렬화 할 수 있는 작은 태스크들</strong>을 아주 빨리 처리할 수 있도록 특별히 설계되었음. 또한 <em>z-buffer</em> 와 같은 특수한 버퍼를 처리하기 위해, 텍스쳐 이미지 혹은 다른 버퍼에 신속하게 접근할 수 있도록 하드웨어가 설계되었음.</p><ul><li>어떻게 처리되는가는 <code>Chapter 23</code> 에서 설명함.</li></ul></li><li><p>무수한 정점들이 한꺼번에 처리되기 위해서는 쉐이더 및 여러가지 연산을 무수히 호출해서 처리하게 하지 않으면 안됨. 이로 인해서 발생하는 지연을 <strong>레이턴시 (Latency)</strong> 라고 함. 일반적으로 레이턴시는 접근할 버퍼가 처리 유닛에서 멀게 되면 증가함.</p><ul><li>자세한 설명은 <code>Section 23.3</code> 에서 설명.</li></ul></li><li><p>메모리 칩에 저장된 정보들은 각 유닛에 부착된 레지스터에 저장된 정보들보다 접근하는 데 더 많은 시간이 걸림.</p><ul><li>자세한 설명은 <code>Section 18.6</code> 에서 설명.</li></ul></li></ul><h2><a name='header-n26' class='md-header-anchor '></a>1. Data-Parallel Architectures</h2><ul><li><p>CPU 는 매우 다양한 자료구조 및 매우 큰 코드들을 효율적으로 처리하기 위하도록 설계되었다. 그런데 CPU 는 코어가 그렇게 많지 않고, 대체로 순서대로 코드들을 처리하다 보니 속도가 느려질 수 있다. 이 속도 저하를 보다 줄이기 위해, 다양한 방법들이 사용되고 있다.</p><ul><li><em>SIMD (Single Instruction Multi Data)</em> 를 사용해서 속도를 잠재적으로 높일 수 있지만 한계가 있다.</li><li>하드웨어에서 사용하는 방법으로는 <em>분기 예측</em>, <em>명령어 재배열</em>, <em>레지스터 변경</em>, <em>캐시 프리패칭</em> 등이 있다. <code>[715]</code></li></ul></li><li><p>GPU 는 <strong>개개의 코어가 CPU 보다는 많이 느리지만, 많은 코어를 배치 가능하다는 점에서 병렬화된 태스크를 전체적으로는 CPU 보다 더 빠르게</strong> 처리할 수 있다. <code>[462]</code></p><ul><li>GPU 의 각각의 코어를 <strong>Shader Core</strong> 라고 한다.</li></ul></li><li><p>렌더링 작업 시, 일반 메모리에 존재하는 텍스쳐 등을 가지고 쉐이더를 처리할 때 버퍼 접근 시의 Stalling 을 줄이기 위해, GPU 의 각 프로세서 단에서 텍스쳐의 Fragment 을 레지스터에 적재하여 처리하게 할 수도 있다. 이를 사용함으로써 Stalling 을 줄이고 처리속도를 늘일 수 있다.</p></li><li><p><strong>GPU 는 SIMD 을 적극적으로 활용한다.</strong> <em>SIMD</em> 는 데이터 군(群) 과 명령어를 나눠서 데이터 독립적으로 이론 상 몇배의 속도로 동시에 처리할 수 있다. </p><ul><li>어느 한 <em>Fragment</em> 에 대한 각각의 픽셀 쉐이더 호출의 작업을 <strong>Thread</strong> 라고 부를 수 있다.</li><li>동일한 쉐이더 프로그램을 사용하는 <em>Thread</em> 들은 일정 개수들로 묶어서 <strong>Warp / Wavefront</strong> 라고 부를 수 있다. 이 Warp 는 GPU 쉐이더 코어군에 의해 묶여서 실행될 수 있으며, 실행 순서를 배정받는다.</li><li>따라서 Warp 의 Thread 들은 동시에 실행되기 위해 (Warp 단위로) <strong>SIMD lane</strong> 에 맵핑된다.</li></ul></li><li><p>GPU 는 CPU 와는 다르게 완전히 <em>SIMD</em> 을 사용하도록 하드웨어가 설계되었기 때문에, <code>if</code> 와 같은 브랜칭 명령어에는 대단히 취약하다. 왜냐면 Warp 의 스레드들 중에서, 하나는 <code>then</code> 구문을, 다른 하나는 <code>else</code> 구문을 택할 수 있기 때문이다.</p><ul><li><p>이를 <strong>Thread Divergence</strong> 라고 부르며, 이 분기문을 수행하기 위해 모든 Thread 들은 <code>then</code> 과 <code>else</code> 을 전부 다 수행해서 분기에 맞지 않는 결과를 버려야 한다.</p><ul><li>최근에는 이 <code>if</code> 구문을 컴파일 시 최적화하는 경우도 더러 존재한다.</li></ul></li></ul></li></ul><h2><a name='header-n59' class='md-header-anchor '></a>2. GPU Pipeline Overview</h2><ul><li><p>GPU 는 <strong>Logical model</strong> 과 <strong>Physical Model</strong> 로 나뉜다. 이는 프로그래머에게 보다 더 추상화된 모델을 제공함으로써 편하게 그래픽스 작업을 하기 위함이라고 한다. <em>Logical Model</em> 과 <em>Physical Model</em> 은 항상 같으리라는 법은 없으며, Physical Model 은 하드웨어 벤더에 의해 각기 다 다를 수도 있다.</p><ul><li><em>Logical Model</em> 은
<code>VS</code> <code>Tessellation</code> <code>GS</code> <code>Clipping</code> <code>Screen Mapping</code> <code>Triangle Setup &amp; Traversal</code> <code>Pixel Shader</code> <code>Merger</code> 
의 스테이지 구성으로 나뉜다.</li></ul></li><li><p><em>Merger Stage</em> 는 일반적으로 Fixed-Function 스테이지이다. 여기서는 <strong>세팅에 의한 컬러 조정, z-buffer, blend, stencil test</strong> 등을 담당한다.</p><ul><li>Early depth-testing 과 같은, 래스터라이저 이전의 고정 함수 단계를 제외하면 거의 모든 고정 함수 상태의 프로세싱은 Merger 에서 수행해도 된다고 봐도 될 듯.</li></ul></li></ul><h2><a name='header-n71' class='md-header-anchor '></a>3. The Programmable Shader Stage</h2><ul><li><p><em>Draw Call</em> 은 그래픽스 API 로 하여금 프리미티브 (토폴로지) 를 그리게 하는 것을 말한다. 인풋 어셈블리와 쉐이더를 돌리는 형태로 드로우 콜이 실행된다.</p></li><li><p>각각의 쉐이더 스테이지이 입력은 두 가지 종류로 나뉜다. 하나는 <strong>Uniform</strong> 이고 또 하나는 <strong>Varying</strong> 이다.</p><ul><li><strong>Uniform</strong> 은 하나의 드로우 콜에서 고정된 값을 가지는 입력 값들이다. Uniform 은 Varying 과는 다르게 각 정점마다 인풋이 다 다를 필요가 없기 때문에 꽤 많은 값의 허용범위를 가진다.</li><li><strong>Varying</strong> 은 인풋 어셈블리 혹은 래스터라이제이션 이후의 각각의 정점이 가진 값들의 입력 값을 말한다. <em>Uniform</em> 과는 달리 각 정점마다 각기 다른 값들이 들어가야 하기 때문에 허용범위는 꽤 작을 수 있다.</li></ul></li><li><p>쉐이더를 실행하는 추상화된 그래픽스 VM (Virtual Machine) 은 각기 다른 입력과 출력 값들에 대해 특별한 레지스터를 사용하고 있다. <em>Uniform</em> 의 경우에는 <strong>Constant Register</strong> 라는 것을 사용하고 있는데, 이 <em>Constant Register</em> 는 입력될 수 있는 값들의 개수 범위가 크다. 그리고 <strong>Temporary Resgiter</strong> 는 쉐이더 VM 에서 다양하게 사용될 수 있는 레지스터이다.</p><ul><li><code>Varying</code> <code>Uniform</code> <code>Constant Regiter</code> <code>Temporary Register</code> <code>VM</code> <code>Texture</code> 의 구성에 관한 도면은 책의 <code>p36</code> 을 보라.</li></ul></li><li><p><strong>Intrinsic Functions</strong> 은 Shader VM 에서 일반적인 연산 혹은 간단한 연산들을 수행할 때 GPU 에 의해 최적화 될 수 있는 함수들을 말한다.</p></li><li><p>Shader 에서의 분기 예측 (<code>if</code> <code>for</code>) 은 정적인가 동적인가에 따라 두 종류로 나뉠 수 있다.</p><ul><li><strong>Static Flow Control</strong> 은 <em>Uniform</em> 값에 의해서 결정이 된다. 드로우 콜을 할 때, 유니폼의 값은 변하지 않기 때문에 (보통) 따라서 성능이 떨어지는 일이 없을 것이다.</li><li><strong>Dynamic Flow Control</strong> 은 Varying 값에 의해서 결정이 되는데, 이는 코드가 다 다르게 결정이 될 수 있다는 것을 내포한다. 따라서 성능이 떨어질 가능성이 존재한다.</li></ul></li></ul><h2><a name='header-n96' class='md-header-anchor '></a>5. The Vertex Shader</h2><ul><li><p>Vertex Shader 는 <strong>첫번째로 프로그래밍이 가능한 쉐이더 스테이지</strong>이다.</p><ul><li><em>VS</em> 에서는 단순히 어셈블러에서 취합해서 가져온 정점만을 독립적으로 다른 정점으로 변환하기 때문에, 정점이 모여서 이루어진 토폴로지 자체에 대한 조작은 불가능하다.</li><li>노멀값은 삼각형 토폴로지의 중심이 되는 노멀이 아닌, 잠재적으로 삼각형을 이룰 수 있는 각 정점의 노멀을 사용한다.</li><li>독립된 정점만을 가지고 쉐이더를 수행하기 때문에, 매우 효율적으로 병렬화해서 수행될 수 있다.</li></ul></li><li><p><strong>Input Assembler</strong> (in D3D) 는 <em>VS</em> 이전에 일어나는 고정된 스테이지로, 버퍼와 버퍼 서술자에 따라 각각의 메모리 배열을 가지고 와서 <strong>하나의 정점으로 취합</strong> 해주는 스테이지이다.</p><ul><li>Input Assembler 는 <strong>Instancing</strong> 을 가능하게 할 수 있다.
자세한 설명은 <code>Section 18.4.2</code> 에서 설명한다고 한다.</li><li>Input Assembler 스테이지는 Logical 한 쉐이더 스테이지 모델에서 존재하고, Physical 한 쉐이더 파이프라인 구조에서는 존재하지 않을 수 있다. 논리적인 파이프라인에서와는 달리 물리적인 파이프라인에서는 <em>VS</em> 자체에서 정점을 취합해서 입력하게 할 수도 있다.</li></ul></li><li><p><em>VS</em> 는 대개 다음과 같은 효과를 구현하고자 할 때 유용하게 사용될 수 있다.</p><ul><li>Object Genration</li><li>Skinned Animation</li><li>Procedural Deformations <code>[802, 943]</code></li><li>Terrain Height Field applying <code>[40, 1227]</code></li></ul></li></ul><h2><a name='header-n125' class='md-header-anchor '></a>6. The Tessellation Stage</h2><ul><li><p>Tessellation Stage (<em>TS</em>) 는 비교적 최근에 추가된 쉐이더 스테이지로, 기존의 <strong>곡면 메쉬를 세분화하여 CPU 의 영향을 받지 않고 보다 더 부드러운 메쉬를 만들어주는 스테이지이다.</strong></p><ul><li>D3D11, OpenGL 4.0, OpenGL ES 3.2 부터 추가되었음.</li></ul></li><li><p><em>TS</em> 는 3 개의 스테이지로 구성된다. D3D11 에서는...</p><ol start='' ><li><strong>Hull Shader</strong> : VS 에서 가져온 정점 패치를 입력으로 받아, 뒷 고정 스테이지인 <em>Tessellator</em> 에 테셀레이션의 강도(<strong>Tessellation Factor</strong>)를 정하게 하거나, Discard 하게 한다. OpenGL 에서는 <em>Tessellation Control Shader</em> 라고 함.</li><li><strong>Tessellator</strong> : <em>HS</em> 에서의 테셀레이션 정도를 사용해서 패치의 세분화된 토폴로지의 컨트롤 포인트 간의 세부 토폴로지를 만드는 고정된 테셀레이션을 수행한다. 이 스테이지에 의해서 새로운 정점들이 생성된다.</li><li><strong>Domain Shader</strong> : 입력으로 <em>HS</em> 에서의 컨트롤 포인트들을 받아서, 각각의 정점에 대한 출력을 결정한다. 이 프로그래밍 가능한 스테이지의 입출력은 <em>VS</em> 와 비슷한데, 즉 입력으로 테셀레이터에서 생성된 정점을 가지고, 작업을 한 뒤에 가공된 정점을 출력한다. OpenGL 에서는 <em>Tessellation Evaluation Shader</em> 라고 한다.</li></ol></li><li><p><strong>Tessellation Factor</strong> 는 두 가지 레벨로 나뉜다.</p><ol start='' ><li><p><strong>Inner Edge</strong> : 패치 (Patch) 의 각 삼각형에서 얼마만큼의 (재귀적인?) 삼각형 분화가 일어날 것인가를 결정.</p></li><li><p><strong>Outer Edge</strong> : 패치의 각 삼각형의 외부 간선이 몇 개로 분리될 것인가를 결정. 만약 <span class="MathJax_SVG" tabindex="-1" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.161ex" height="1.967ex" viewBox="0 -745.8 500 846.9" role="img" focusable="false" style="vertical-align: -0.235ex;"><defs><path stroke-width="0" id="E2-MJMAIN-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#E2-MJMAIN-30" x="0" y="0"></use></g></svg></span><script type="math/tex"> 0 </script> 인 경우에는 해당 삼각형을 Discard 한다.</p><ul><li>자세한 설명은 <code>Section 17.6</code> 에 있다고 한다.</li></ul></li></ol></li><li><p>테셀레이션에 의해 생성되는 각 정점은 <strong>Barycentric Coordinate (삼각형의 3개의 정점의 중심을 기준으로 한 좌표계)</strong> 를 사용해서 생성된다. 이를 사용해서 어떻게 정점을 생성하는 가는 <code>Section 22.8</code> 에서 자세히 다룬다.</p><blockquote><p><a href='http://mathworld.wolfram.com/BarycentricCoordinates.html' target='_blank' class='url'>http://mathworld.wolfram.com/BarycentricCoordinates.html</a>
Barycentric Coordinate 는 대개 삼각형 (Simplex) 의 3 개의 정점 <span class="MathJax_SVG" tabindex="-1" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="24.135ex" height="2.773ex" viewBox="0 -844.9 10391.3 1194" role="img" focusable="false" style="vertical-align: -0.811ex;"><defs><path stroke-width="0" id="E3-MJMAIN-28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path><path stroke-width="0" id="E3-MJMAIN-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path stroke-width="0" id="E3-MJMAIN-2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path><path stroke-width="0" id="E3-MJMAIN-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path><path stroke-width="0" id="E3-MJMAIN-29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#E3-MJMAIN-28" x="0" y="0"></use><use xlink:href="#E3-MJMAIN-31" x="389" y="0"></use><use xlink:href="#E3-MJMAIN-2C" x="889" y="0"></use><use xlink:href="#E3-MJMAIN-30" x="1333" y="0"></use><use xlink:href="#E3-MJMAIN-2C" x="1833" y="0"></use><use xlink:href="#E3-MJMAIN-30" x="2278" y="0"></use><use xlink:href="#E3-MJMAIN-29" x="2778" y="0"></use><use xlink:href="#E3-MJMAIN-2C" x="3167" y="0"></use><use xlink:href="#E3-MJMAIN-28" x="3612" y="0"></use><use xlink:href="#E3-MJMAIN-30" x="4001" y="0"></use><use xlink:href="#E3-MJMAIN-2C" x="4501" y="0"></use><use xlink:href="#E3-MJMAIN-31" x="4945" y="0"></use><use xlink:href="#E3-MJMAIN-2C" x="5445" y="0"></use><use xlink:href="#E3-MJMAIN-30" x="5890" y="0"></use><use xlink:href="#E3-MJMAIN-29" x="6390" y="0"></use><use xlink:href="#E3-MJMAIN-2C" x="6779" y="0"></use><use xlink:href="#E3-MJMAIN-28" x="7224" y="0"></use><use xlink:href="#E3-MJMAIN-30" x="7613" y="0"></use><use xlink:href="#E3-MJMAIN-2C" x="8113" y="0"></use><use xlink:href="#E3-MJMAIN-30" x="8557" y="0"></use><use xlink:href="#E3-MJMAIN-2C" x="9057" y="0"></use><use xlink:href="#E3-MJMAIN-31" x="9502" y="0"></use><use xlink:href="#E3-MJMAIN-29" x="10002" y="0"></use></g></svg></span><script type="math/tex"> (1, 0, 0), (0, 1, 0), (0, 0, 1) </script> (아핀 공간) 에 대해,</p><div contenteditable="false" spellcheck="false" class="mathjax-block md-end-block md-math-block md-rawblock" id="mathjax-n155" cid="n155" mdtype="math_block"><div class="md-rawblock-container md-math-container" tabindex="-1"><div class="MathJax_SVG_Display"><span class="MathJax_SVG" id="MathJax-Element-1030-Frame" tabindex="-1" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="735.382px" height="129.132px" viewBox="0 -1787 36444.2 6400.3" role="img" focusable="false" style="vertical-align: -10.715ex; max-width: 100%;"><defs><path stroke-width="0" id="E1046-MJMAINB-70" d="M32 442L123 446Q214 450 215 450H221V409Q222 409 229 413T251 423T284 436T328 446T382 450Q480 450 540 388T600 223Q600 128 539 61T361 -6H354Q292 -6 236 28L227 34V-132H296V-194H287Q269 -191 163 -191Q56 -191 38 -194H29V-132H98V113V284Q98 330 97 348T93 370T83 376Q69 380 42 380H29V442H32ZM457 224Q457 303 427 349T350 395Q282 395 235 352L227 345V104L233 97Q274 45 337 45Q383 45 420 86T457 224Z"></path><path stroke-width="0" id="E1046-MJMAIN-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path><path stroke-width="0" id="E1046-MJSZ2-2211" d="M60 948Q63 950 665 950H1267L1325 815Q1384 677 1388 669H1348L1341 683Q1320 724 1285 761Q1235 809 1174 838T1033 881T882 898T699 902H574H543H251L259 891Q722 258 724 252Q725 250 724 246Q721 243 460 -56L196 -356Q196 -357 407 -357Q459 -357 548 -357T676 -358Q812 -358 896 -353T1063 -332T1204 -283T1307 -196Q1328 -170 1348 -124H1388Q1388 -125 1381 -145T1356 -210T1325 -294L1267 -449L666 -450Q64 -450 61 -448Q55 -446 55 -439Q55 -437 57 -433L590 177Q590 178 557 222T452 366T322 544L56 909L55 924Q55 945 60 948Z"></path><path stroke-width="0" id="E1046-MJMATHI-69" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path><path stroke-width="0" id="E1046-MJMAIN-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path stroke-width="0" id="E1046-MJMAIN-33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path stroke-width="0" id="E1046-MJMATHI-61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path><path stroke-width="0" id="E1046-MJMATHI-76" d="M173 380Q173 405 154 405Q130 405 104 376T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Q21 294 29 316T53 368T97 419T160 441Q202 441 225 417T249 361Q249 344 246 335Q246 329 231 291T200 202T182 113Q182 86 187 69Q200 26 250 26Q287 26 319 60T369 139T398 222T409 277Q409 300 401 317T383 343T365 361T357 383Q357 405 376 424T417 443Q436 443 451 425T467 367Q467 340 455 284T418 159T347 40T241 -11Q177 -11 139 22Q102 54 102 117Q102 148 110 181T151 298Q173 362 173 380Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g transform="translate(15579,0)"><use xlink:href="#E1046-MJMAINB-70" x="0" y="0"></use><use xlink:href="#E1046-MJMAIN-3D" x="916" y="0"></use><g transform="translate(1972,0)"><use xlink:href="#E1046-MJSZ2-2211" x="0" y="0"></use><g transform="translate(148,-1088)"><use transform="scale(0.707)" xlink:href="#E1046-MJMATHI-69" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#E1046-MJMAIN-3D" x="345" y="0"></use><use transform="scale(0.707)" xlink:href="#E1046-MJMAIN-31" x="1123" y="0"></use></g><use transform="scale(0.707)" xlink:href="#E1046-MJMAIN-33" x="771" y="1626"></use></g><g transform="translate(3583,0)"><use xlink:href="#E1046-MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#E1046-MJMATHI-69" x="748" y="-213"></use></g><g transform="translate(4456,0)"><use xlink:href="#E1046-MJMATHI-76" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#E1046-MJMATHI-69" x="685" y="-213"></use></g></g><g transform="translate(16063,-3347)"><use xlink:href="#E1046-MJSZ2-2211" x="0" y="0"></use><g transform="translate(148,-1088)"><use transform="scale(0.707)" xlink:href="#E1046-MJMATHI-69" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#E1046-MJMAIN-3D" x="345" y="0"></use><use transform="scale(0.707)" xlink:href="#E1046-MJMAIN-31" x="1123" y="0"></use></g><use transform="scale(0.707)" xlink:href="#E1046-MJMAIN-33" x="771" y="1626"></use><g transform="translate(1610,0)"><use xlink:href="#E1046-MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#E1046-MJMATHI-69" x="748" y="-213"></use></g><use xlink:href="#E1046-MJMAIN-3D" x="2761" y="0"></use><use xlink:href="#E1046-MJMAIN-31" x="3817" y="0"></use></g></g></svg></span></div><script type="math/tex; mode=display" id="MathJax-Element-1030">\mathbf{p} = \sum_{i = 1}^{3}a_iv_i \\
\sum_{i = 1}^{3}a_i = 1</script></div></div><p>인 삼각형의 무게 중심 <span class="MathJax_SVG" tabindex="-1" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.484ex" height="1.852ex" viewBox="0 -547.4 639 797.3" role="img" focusable="false" style="vertical-align: -0.58ex;"><defs><path stroke-width="0" id="E4-MJMAINB-70" d="M32 442L123 446Q214 450 215 450H221V409Q222 409 229 413T251 423T284 436T328 446T382 450Q480 450 540 388T600 223Q600 128 539 61T361 -6H354Q292 -6 236 28L227 34V-132H296V-194H287Q269 -191 163 -191Q56 -191 38 -194H29V-132H98V113V284Q98 330 97 348T93 370T83 376Q69 380 42 380H29V442H32ZM457 224Q457 303 427 349T350 395Q282 395 235 352L227 345V104L233 97Q274 45 337 45Q383 45 420 86T457 224Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#E4-MJMAINB-70" x="0" y="0"></use></g></svg></span><script type="math/tex"> \mathbf{p} </script> 을 기준으로 하는 좌표계이다.</p></blockquote></li></ul><h2><a name='header-n157' class='md-header-anchor '></a>7. The Geometry Shader</h2><ul><li><p>Geometry Shader 는 <strong>토폴로지 (Primitive) 를 다른 토폴로지로 변환시킬 수 있다.</strong> 이는 이전 스테이지인 <em>HS 와 DS</em> 가 추가적인 면을 만들어서 부드러운 면을 만들게끔 하는 특화된 것과는 달리 보다 범용적이다. 예를 들어서, 삼각형을 선으로 변환시킬 수 있고, 혹은 삼각형을 삼각형들로 복제해서 유사 복셀을 구현할 수도 있다.</p></li><li><p>지오메트리 쉐이더를 사용한 예를 설명한 것으로는 <code>Section 10.4.3</code>
혹은 쉐도우 맵핑 시 정점 정보를 각각의 쉐도우 맵에 렌더링하게 하는 것,
또는 한번의 콜로 큐브맵의 각 면에 렌더링하게 하는 등의 테크닉이 있다.</p></li><li><p><em>GS</em> 는 변형된 프리미티브를 출력할 때, 인풋된 프리미티브의 어셈블리 순서대로 출력하도록 보장이 된다. 이는 곧 <em>GS</em> 을 씀으로써 전반적인 파이프라인의 성능에 영향을 미칠 수 있다는 것이 된다. <em>GS</em> 가 각기 다른 스레드에서 동작해서 아웃풋이 된다고 하면, 변형된 프리미티브를 파이프라인의 어셈블리 스코프에 넣기 위해 결과가 따로 보관되어야 하며, 재정렬되어야 한다. <code>[175, 530]</code></p><ul><li><em>GS</em> 는 VS 나 PS 와는 다르게 많이 쓰이지 않으며, 이를 아예 배제하는 파이프라인도 존재한다.</li></ul></li></ul><h3><a name='header-n168' class='md-header-anchor '></a>7.1 Stream Output (Transform Feedback)</h3><blockquote><p><a href='https://www.khronos.org/opengl/wiki/Transform_Feedback' target='_blank' class='url'>https://www.khronos.org/opengl/wiki/Transform_Feedback</a></p></blockquote><ul><li><p><strong>Stream Output (Transform Feedback)</strong> 은 레스터라이제이션 바로 이전의 단계에서 변형된 정점들의 정보를 일렬화된 버퍼를 통해 파이프라인 바깥으로 CPU 에게 출력할 수 있도록 한다.</p><ul><li>이 스테이지는 입력된 정점과 출력되는 정점의 순서들이 보장된다.</li></ul></li><li><p>이 스테이지는 옵셔널하면서, 쓴다고 하더라도 레스터라이제이션 단계로도 가공된 정보들이 전달된다.</p></li><li><p><em>SO (TF)</em> 는 사양 상, 단정도 부동소수점의 형태로만 버퍼 출력이 가능하며, 버퍼 출력 시 정점의 순서에 따라서 버퍼에 정보가 입력되어야 하기 때문에 파이프라인의 성능에 영향을 미칠 수 있다.</p></li></ul><h2><a name='header-n181' class='md-header-anchor '></a>8. The Pixel Shader</h2><ul><li><p><em>PS</em> 이전에, 래스터라이제이션 단계에서는 다음과 같은 작업을 한다.</p><ol start='' ><li>정점들을 순서대로 순회해서, 스크린 상에 해당 정점들이 픽셀을 덮는 삼각형을 이루는가를 검사한다.</li><li>삼각형이 픽셀을 얼마나 덮는지를 계산한다. <code>Section 5.4.2</code></li><li>고정 함수 상태에 의해서 삼각형 렌더링의 순서가 시계 방향 / 반시계 등등일 경우에 컬링을 할지 결정한다.</li><li>덮은 삼각형들에 대해, 각 정점의 출력의 값들을 <strong>정해진 상태에 따라</strong> 보간을 실시해서 Fragment 에 보간된 값들을 결정시킨다.</li></ol></li><li><p>래스터라이제이션 단계에서, <strong>각 픽셀을 덮은 삼각형 군(群)을</strong> <strong><em>Fragment</em></strong> 라고 한다.</p></li><li><p><em>PS</em> 는 discard 기능을 가지고 있다. 또한 <em>PS</em> 는 렌더 타겟을 여러 개 지정하여, 컬러의 값을 각각의 렌더 타겟에 동시에 지정하게 할 수 있다. 이를 통해 Deferred Rendering 이 가능해짐.</p><ul><li>자세한 것은 <code>Section 20.1.</code> 에서 확인 가능.</li></ul></li><li><p><em>PS</em> 는 <code>dv/dy</code> 혹은 <code>dv/dx</code> 와 같은,  2 x 2 의 블럭 <strong>Quad</strong> 에서 삼각형이 각 픽셀을 차지하는 양이 얼마나 변하는가를 확인할 수 있도록 API 을 제공해주고 있다. 이를 사용해서 텍스쳐 필터링으로 각종 효과를 덤으로 구현할 수 있을 것이다. 다만 이 경우에는 동적인 분기를 만들지 않도록 해야한다. 왜냐하면 <code>dv/dy</code> 와 <code>dv/dx</code> 는 다른 프래그먼트의 정보를 간접적으로 접근하기 때문에, 분기를 만들면 값이 무용지물된다고 보기 때문.</p></li></ul><h2><a name='header-n203' class='md-header-anchor '></a>9. The Merging Stage</h2><ul><li><p>해당 스테이지를 D3D 에서는 <em>Output Merger</em>, 
OpenGL 에서는 <em>per-sample Operation</em> 이라고 한다.</p></li><li><p>이 스테이지에서...</p><ol start='' ><li>스텐실 테스트</li><li>Z-테스트</li><li>블렌딩</li></ol><p>이 수행된다.</p></li><li><p>Z-테스트의 경우, 마지막 스테이지에서 수행하기에는 씬이 복잡해지면 거의 대다수의 프래그먼트가 discard 되기 때문에, 성능 저하를 막기 위해 <em>PS</em> 에서 z값을 변경하는 코드가 들어있지 않으면, <strong>early-z test</strong> 을 래스터라이제이션 단계 이전에 수행하게 된다.</p><ul><li><code>Section 23.7</code> 과 <code>Section 18.4.5</code> 에서 이와 같은 성능 최적화를 좀 더 자세히 다룬다.</li></ul></li></ul><h2><a name='header-n222' class='md-header-anchor '></a>10. The Compute Shader</h2><ul><li>GPGPU 와 같이, GPU Computing 을 사용해서 GPU 에 최적화된 연산을 수행하는 스테이지. 이 스테이지는 일반 GPU 렌더링 파이프라인에 묶이지 않으며, VRAM 에 존재하는 다양한 버퍼를 GPU 단에서 직접 조작하거나 접근하는 것이 가능하다.</li><li>이를 적극 활용해서, GPU 파티클 시스템, 메쉬 프로세싱, 얼굴 애니메이션, 컬링, 이미지 필터링, DOF, 쉐도우 등과 같은 작업이 가능하다. 뿐만 아니라, 컴퓨터 쉐이더를 사용하면 일반 테셀레이션을 사용하는 것보다 더 효율적이라는 문서도 나와있다.</li></ul><h2><a name='header-n228' class='md-header-anchor '></a>A. 참고</h2><p>[943] : <a href='https://www.google.com/url?sa=t&rct=j&q=&esrc=s&source=web&cd=1&ved=2ahUKEwjH146GzfLhAhWEErwKHT7LCaIQFjAAegQIABAB&url=https%3A%2F%2Fdownload.nvidia.com%2Fdeveloper%2FGPU_Gems_2%2FGPU_Gems2_ch18.pdf&usg=AOvVaw30ncpLaAEuIryWjR-m5cVi' target='_blank' class='url'>https://www.google.com/url?sa=t&rct=j&q=&esrc=s&source=web&cd=1&ved=2ahUKEwjH146GzfLhAhWEErwKHT7LCaIQFjAAegQIABAB&url=https%3A%2F%2Fdownload.nvidia.com%2Fdeveloper%2FGPU_Gems_2%2FGPU_Gems2_ch18.pdf&usg=AOvVaw30ncpLaAEuIryWjR-m5cVi</a></p><p>[1227] : <a href='https://dl.acm.org/citation.cfm?id=1281671' target='_blank' class='url'>https://dl.acm.org/citation.cfm?id=1281671</a></p><p>[530] : <a href='https://fgiesen.wordpress.com/2011/07/09/a-trip-through-the-graphics-pipeline-2011-index/' target='_blank' class='url'>https://fgiesen.wordpress.com/2011/07/09/a-trip-through-the-graphics-pipeline-2011-index/</a></p><p>&nbsp;</p></div>
</body>
</html>